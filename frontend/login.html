<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>BookMyStay - Login</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
<style>
* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

:root {
  --primary: #0d6e7c;
  --primary-dark: #0d6e7c;
  --error: #dc2626;
  --success: #16a34a;
  --text: #1f2937;
  --text-light: #6b7280;
  --border: #e5e7eb;
  --bg: #f5f0ea;
}

body {
  font-family: 'Inter', sans-serif;
  background: var(--bg);
  min-height: 100vh;
  display: flex;
  align-items: center;
  justify-content: center;
  padding: 20px;
}

.container {
  width: 100%;
  max-width: 420px;
}

.logo {
  text-align: center;
  margin-bottom: 48px;
}

.logo h1 {
  font-size: 28px;
  font-weight: 700;
  color: var(--text);
  letter-spacing: -0.5px;
}

.logo p {
  color: var(--text-light);
  font-size: 14px;
  margin-top: 8px;
}

.card {
  background: white;
  border-radius: 16px;
  padding: 40px;
  box-shadow: 0 1px 3px rgba(0, 0.3, 0.5, 0.3);
}

.tabs {
  display: flex;
  gap: 8px;
  margin-bottom: 32px;
  background: var(--bg);
  padding: 4px;
  border-radius: 10px;
}

.tab-btn {
  flex: 1;
  padding: 10px;
  border: none;
  background: transparent;
  color: var(--text-light);
  font-weight: 500;
  font-size: 14px;
  cursor: pointer;
  border-radius: 8px;
  transition: all 0.2s;
}

.tab-btn.active {
  background: white;
  color: var(--text);
  box-shadow: 0 1px 2px rgba(0, 0, 0, 0.05);
}

.form-tab {
  display: none;
}

.form-tab.active {
  display: block;
  animation: fadeIn 0.3s ease;
}

@keyframes fadeIn {
  from { opacity: 0; transform: translateY(10px); }
  to { opacity: 1; transform: translateY(0); }
}

.input-group {
  margin-bottom: 20px;
}

.input-group label {
  display: block;
  font-size: 14px;
  font-weight: 500;
  color: var(--text);
  margin-bottom: 8px;
}

.input-group input {
  width: 100%;
  padding: 12px 16px;
  border: 1.5px solid var(--border);
  border-radius: 10px;
  font-size: 15px;
  transition: all 0.2s;
  font-family: 'Inter', sans-serif;
}

.input-group input:focus {
  outline: none;
  border-color: var(--primary);
  box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
}

.input-group input.error {
  border-color: var(--error);
}

.message {
  padding: 12px 16px;
  border-radius: 10px;
  font-size: 14px;
  margin-bottom: 20px;
  display: none;
}

.message.show {
  display: block;
  animation: slideDown 0.3s ease;
}

@keyframes slideDown {
  from { opacity: 0; transform: translateY(-10px); }
  to { opacity: 1; transform: translateY(0); }
}

.message.error {
  background: #fee2e2;
  color: var(--error);
  border: 1px solid #fecaca;
}

.message.success {
  background: #dcfce7;
  color: var(--success);
  border: 1px solid #bbf7d0;
}

.submit-btn {
  width: 100%;
  padding: 14px;
  background: var(--primary);
  color: white;
  border: none;
  border-radius: 10px;
  font-size: 15px;
  font-weight: 600;
  cursor: pointer;
  transition: all 0.2s;
  font-family: 'Inter', sans-serif;
}

.submit-btn:hover {
  background: var(--primary-dark);
  transform: translateY(-1px);
}

.submit-btn:disabled {
  opacity: 0.6;
  cursor: not-allowed;
  transform: none;
}

.footer-text {
  text-align: center;
  margin-top: 24px;
  font-size: 14px;
  color: var(--text-light);
}

.footer-text a {
  color: var(--primary);
  text-decoration: none;
  font-weight: 500;
}

.footer-text a:hover {
  text-decoration: underline;
}

.demo-info {
  margin-top: 24px;
  padding: 16px;
  background: #fef3c7;
  border: 1px solid #f0e5bd;
  border-radius: 10px;
  font-size: 13px;
  color: #92400e;
}

.demo-info strong {
  display: block;
  margin-bottom: 8px;
}

@media (max-width: 480px) {
  .card {
    padding: 32px 24px;
  }
}
</style>
</head>
<body>

<div class="container">
  <div class="logo">
    <h1>BookMyStay</h1>
    <p>Your gateway to premium stays</p>
  </div>

  <div class="card">
    <div class="tabs">
      <button class="tab-btn active" onclick="switchTab('login')">Login</button>
      <button class="tab-btn" onclick="switchTab('signup')">Sign Up</button>
    </div>

    <!-- LOGIN FORM -->
    <div class="form-tab active" id="loginTab">
      <div class="message error" id="loginMessage"></div>
      
      <form onsubmit="handleLogin(event)">
        <div class="input-group">
          <label>Email</label>
          <input type="email" id="loginEmail" placeholder="you@example.com" required>
        </div>

        <div class="input-group">
          <label>Password</label>
          <input type="password" id="loginPassword" placeholder="Enter your password" required minlength="6">
        </div>

        <button type="submit" class="submit-btn" id="loginBtn">Login</button>
      </form>

      <div class="footer-text">
        Don't have an account? <a href="#" onclick="switchTab('signup'); return false;">Sign up</a>
      </div>
    </div>

    <!-- SIGNUP FORM -->
    <div class="form-tab" id="signupTab">
      <div class="message error" id="signupErrorMessage"></div>
      <div class="message success" id="signupSuccessMessage"></div>
      
      <form onsubmit="handleSignup(event)">
        <div class="input-group">
          <label>Full Name</label>
          <input type="text" id="signupName" placeholder="John Doe" required>
        </div>

        <div class="input-group">
          <label>Email</label>
          <input type="email" id="signupEmail" placeholder="you@example.com" required>
        </div>

        <div class="input-group">
          <label>Password</label>
          <input type="password" id="signupPassword" placeholder="Minimum 6 characters" required minlength="6">
        </div>

        <button type="submit" class="submit-btn" id="signupBtn">Create Account</button>
      </form>

      <div class="footer-text">
        Already have an account? <a href="#" onclick="switchTab('login'); return false;">Login</a>
      </div>
    </div>

    <div class="demo-info">
      <strong>Demo Mode</strong>
      Try: demo@bookmystay.com / password123 or create a new account!
    </div>
  </div>
</div>
<script src="api.js"></script>
<script>
  const API_URL = "https://bookmystay-backend.onrender.com/api";
// Load existing users from localStorage or use demo user
function loadUsers() {
  const stored = localStorage.getItem('bookmystay_users');
  if (stored) {
    return JSON.parse(stored);
  }
  return [
    { name: 'Demo User', email: 'demo@bookmystay.com', password: 'password123' }
  ];
}

function saveUsers(users) {
  localStorage.setItem('bookmystay_users', JSON.stringify(users));
}

let users = loadUsers();

function switchTab(tab) {
  document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
  document.querySelectorAll('.form-tab').forEach(form => form.classList.remove('active'));
  hideMessages();
  
  if (tab === 'login') {
    document.querySelector('.tab-btn:first-child').classList.add('active');
    document.getElementById('loginTab').classList.add('active');
  } else {
    document.querySelector('.tab-btn:last-child').classList.add('active');
    document.getElementById('signupTab').classList.add('active');
  }
}

function showMessage(id, text) {
  const el = document.getElementById(id);
  el.textContent = text;
  el.classList.add('show');
}

function hideMessages() {
  document.querySelectorAll('.message').forEach(msg => {
    msg.classList.remove('show');
  });
}

function handleLogin(e) {
  e.preventDefault();
  hideMessages();

  const email = document.getElementById('loginEmail').value.trim();
  const password = document.getElementById('loginPassword').value;
  const btn = document.getElementById('loginBtn');

  btn.disabled = true;
  btn.textContent = 'Logging in...';

  setTimeout(() => {
    const user = users.find(u => u.email.toLowerCase() === email.toLowerCase() && u.password === password);

    if (!user) {
      showMessage('loginMessage', 'Invalid email or password');
      btn.disabled = false;
      btn.textContent = 'Login';
      return;
    }

    // âœ… SAVE TO LOCALSTORAGE - THIS IS THE FIX!
    localStorage.setItem('isLoggedIn', 'true');
    localStorage.setItem('authToken', 'token_' + Date.now());
    localStorage.setItem('user', JSON.stringify({
      name: user.name,
      email: user.email
    }));

    console.log('âœ… Login successful! Data saved to localStorage');
    console.log('isLoggedIn:', localStorage.getItem('isLoggedIn'));
    console.log('authToken:', localStorage.getItem('authToken'));
    console.log('user:', localStorage.getItem('user'));

    showMessage('loginMessage', 'âœ… Login successful! Redirecting...');
    document.getElementById('loginMessage').classList.remove('error');
    document.getElementById('loginMessage').classList.add('success');
    
    setTimeout(() => {
      // Check if there's a redirect URL
      const redirectUrl = localStorage.getItem('redirectAfterLogin');
      if (redirectUrl) {
        localStorage.removeItem('redirectAfterLogin');
        window.location.href = redirectUrl;
      } else {
        window.location.href = 'index.html';
      }
    }, 1000);
  }, 800);
}

function handleSignup(e) {
  e.preventDefault();
  hideMessages();

  const name = document.getElementById('signupName').value.trim();
  const email = document.getElementById('signupEmail').value.trim();
  const password = document.getElementById('signupPassword').value;
  const btn = document.getElementById('signupBtn');

  btn.disabled = true;
  btn.textContent = 'Creating account...';

  setTimeout(() => {
    if (users.find(u => u.email.toLowerCase() === email.toLowerCase())) {
      showMessage('signupErrorMessage', 'An account with this email already exists');
      btn.disabled = false;
      btn.textContent = 'Create Account';
      return;
    }

    if (name.length < 2) {
      showMessage('signupErrorMessage', 'Please enter a valid name');
      btn.disabled = false;
      btn.textContent = 'Create Account';
      return;
    }

    if (password.length < 6) {
      showMessage('signupErrorMessage', 'Password must be at least 6 characters');
      btn.disabled = false;
      btn.textContent = 'Create Account';
      return;
    }

    const newUser = { name, email, password };
    users.push(newUser);
    saveUsers(users);

    showMessage('signupSuccessMessage', 'Account created successfully! Please login. ðŸŽ‰');
    
    setTimeout(() => {
      document.getElementById('signupName').value = '';
      document.getElementById('signupEmail').value = '';
      document.getElementById('signupPassword').value = '';
      hideMessages();
      switchTab('login');
      btn.disabled = false;
      btn.textContent = 'Create Account';
    }, 2000);

    console.log('New user created:', newUser);
  }, 800);
}

// Check if already logged in
window.addEventListener('DOMContentLoaded', function() {
  const isLoggedIn = localStorage.getItem('isLoggedIn');
  if (isLoggedIn === 'true') {
    const user = JSON.parse(localStorage.getItem('user') || '{}');
    if (confirm('You are already logged in as ' + user.name + '. Go to home page?')) {
      window.location.href = 'index.html';
    }
  }
});
</script>

</body>
</html>